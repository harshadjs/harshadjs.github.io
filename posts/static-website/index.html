<!DOCTYPE html>
<html lang="en-us" prefix="og: http://ogp.me/ns#" id="top-of-site">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no">

    <link rel="canonical" href="http://harshad.me/posts/static-website/">

    <title>Static Website with Password Protection - Harshad</title>
    <meta name="description" content="After numerous attempts at finding a cheap and easy solution to making a password protected static website, I finally have settled my mind on one! Before going …">
    <meta name="keywords" content="jekyll, tech, git, website">

    <meta name="author" content="">
    <meta name="generator" content="Hugo 0.104.3" />

    
    <link crossorigin="anonymous" href="/css/stylesheet.min.ddff76a17889e714853ced93d59096be3dca89927ec0e446c2d9c6b70da094a6.css" integrity="sha256-3f92oXiJ5xSFPO2T1ZCWvj3KiZJ+wORGwtnGtw2glKY=" rel="preload stylesheet" as="style">

    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    <link rel="manifest" type="application/manifest+json" href="/manifest.webmanifest" title="Manifest">
    <link rel="sitemap" type="application/xml" href="/sitemap.xml" title="Sitemap">
    <link rel="author" type="text/plain" href="/humans.txt" title="Humans">


    <meta name="theme-color" content="#ffffff">    
    <meta property="og:title" content="Static Website with Password Protection - Harshad">
    <meta property="og:description" content="After numerous attempts at finding a cheap and easy solution to making a password protected static website, I finally have settled my mind on one! Before going …">
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://harshad.me/posts/static-website/">
    <meta property="og:image" content="http://harshad.me/img/open-graph-logo.png">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta property="article:published_time" content="2020-05-11T00:00:00">
    <meta property="article:modified_time" content="2020-05-11T00:00:00">
    <meta property="article:tag" content="jekyll">
    <meta property="article:tag" content="tech">
    <meta property="article:tag" content="git">
    <meta property="article:tag" content="website">
    
    <meta name="twitter:title" content="Static Website with Password Protection - Harshad">
    <meta name="twitter:description" content="After numerous attempts at finding a cheap and easy solution to making a password protected static website, I finally have settled my mind on one! Before going …">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://harshad.me/img/open-graph-logo.png">
    

<script type="application/ld+json" id="schema-data">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http://harshad.me/posts/static-website/"
        },
        "url": "http://harshad.me/posts/static-website/",
        "headline": "Static Website with Password Protection - Harshad",
        "description": "After numerous attempts at finding a cheap and easy solution to making a password protected static website, I finally have settled my mind on one! Before going …",
        "keywords": ["jekyll","tech","git","website"],
        "datePublished": "2020-05-11T00:00:00Z",
        "dateModified": "2020-05-11T00:00:00Z",
        "publisher": {
            "@type": "Organization",
            "name": "Harshad",
            "logo": {
                "@type": "ImageObject",
                "url": "http://harshad.me/img/open-graph-logo_hu649006a96c7f6a02c0a48e2d90a9a7b0_5229_96x96_resize_box_3.png",
                "width": "96",
                "height": "96"
            }
        }
    }
</script>



    <script src="/js/common.js"></script>
</head>

    <body class="theme-base-">
        <div id="top-of-site-anchor"></div>
        
            
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<aside class="sidebar" id="sidebar">
    <div class="sidebar-item">
        <p></p>
    </div>

    <nav class="sidebar-nav">
            <a class="sidebar-nav-item"
                href="/posts/"
                id="menu-main-posts">Posts</a>
            <a class="sidebar-nav-item"
                href="/music/"
                id="menu-main-music">Music</a>
            <a class="sidebar-nav-item"
                href="/contact/"
                id="menu-main-contact">Contact</a>
            <a class="sidebar-nav-item"
                href="/search/"
                id="menu-main-search">Search</a>
            <a class="sidebar-nav-item"
                href="/about/"
                id="menu-main-about">About</a>
        <span class="hypothesis-container">
    <a class="sidebar-nav-item" id="hypothesis-link" href="#">Annotate me</a>
</span>

    </nav>

    

</aside>

        
        <div class="wrap">
            <header class="masthead">
                <div class="container">
                    <h3 class="masthead-title">
                        <a href="/" title="Home">Harshad</a>
                        <br><small></small>
                    </h3>
                </div>
            </header>

            <main class="container content" id="main">
                <article class="post" role="document">
    <header>
        <h1 class="text-title">
            Static Website with Password Protection
        </h1>
        <p class="byline">
            
                


Published on
<time datetime="2020-05-11T00:00:00Z">
    May 11, 2020
</time>




            
        </p>
    </header>

    <div class="post-body">
        
<p>
After numerous attempts at finding a cheap and easy solution to making a
password protected static website, I finally have settled my mind on one! Before
going over the solution let me go over the requirements that I had in my mind
for the website:</p>
<ul>
<li>Cheap</li>
<li>Static and blog-aware</li>
<li>Password protection on a part of the website</li>
<li>Smooth and easy workflow to move content from private part to public</li>
<li>Preferably, an automatic CI/CD</li>
</ul>
<p>I tried multiple solutions such as setting up Heroku dynos, CloudCanon
etc. None of the solutions satisfied all the requirements until I found this
option:</p>
<p>
<strong><strong>GitHub + Jekyll + Makefile + AWS S3 + AWS Lambda</strong></strong></p>
<p>
Let me paint a high level picture of how the setup looks like:</p>
<div id="outline-container-headline-1" class="outline-3">
<h3 id="headline-1">
Two GitHub Repositories
</h3>
<div id="outline-text-headline-1" class="outline-text-3">
<p>
 Website content is split into two parts: public and private repositories. The
 <a href="https://github.com/harshadjs/harshadjs.github.io">public repository</a> works like
 any other static website hosted on GitHub.</p>
<p>
 It contains all the jekyll build material and public posts. Private repository
 only contains posts that are private.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-3">
<h3 id="headline-2">
Public Repository Hosting
</h3>
<div id="outline-text-headline-2" class="outline-text-3">
<p>
 The public repository gets hosted on GitHub pages as any other static
 website. This takes care of the public part of the website.</p>
<p>
 Setting up private part is slightly complex but it&#39;s a one-time effort. I&#39;ll try
 to provide a high-level overview how that works.</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
Password Protection
</h3>
<div id="outline-text-headline-3" class="outline-text-3">
<p>
 The private content is hosted in an AWS S3 bucket which only allows
 AWS CloudFront to read the contents. I then setup AWS Lambda that runs
 when a viewer tries to read content via CloudFront
 distribution. Here&#39;s a <a href="http://kynatro.com/blog/2018/01/03/a-step-by-step-guide-to-creating-a-password-protected-s3-bucket/">step-by-step tutorial</a> on how to set up S3 and
 CloudFront.</p>
</div>
</div>
<div id="outline-container-headline-4" class="outline-3">
<h3 id="headline-4">
Building Private Website
</h3>
<div id="outline-text-headline-4" class="outline-text-3">
<p>
 In order to build the private website, we are going to need both the public and
 private repositories. After cloning the public repository, we create a directory
 named <code class="verbatim">&lt;public_repo&gt;/_posts_private</code> and clone the private repository in
 it. Yeah, we could have used git submodules. But, given that the
 <code class="verbatim">_posts_private</code> should point to a private repository, if we use submodules, it
 will break GitHub&#39;s CI/CD for the public website. We don&#39;t want that to
 break. So, we manually clone the private repository inside <code class="verbatim">_posts_private</code>
 folder. The magic happens inside the <code class="verbatim">Makefile</code>.</p>
<table>
<tbody>
<tr>
<td>Command</td>
<td>Action</td>
</tr>
</tbody>
<tbody>
<tr>
<td><code class="verbatim">make _site_private</code></td>
<td>Build private website</td>
</tr>
</tbody>
<tbody>
<tr>
<td><code class="verbatim">make _site_public</code></td>
<td>Build public website</td>
</tr>
</tbody>
<tbody>
<tr>
<td><code class="verbatim">make serve_private</code></td>
<td>Build and run private website locally</td>
</tr>
</tbody>
<tbody>
<tr>
<td><code class="verbatim">make serve_public</code></td>
<td>Build and run public website locally</td>
</tr>
</tbody>
<tbody>
<tr>
<td><code class="verbatim">make sync</code></td>
<td>Update private repository on S3</td>
</tr>
</tbody>
<tbody>
<tr>
<td><code class="verbatim">make clean</code></td>
<td>Clean directory</td>
</tr>
</tbody>
</table>
<p>
 After running <code class="verbatim">make sync</code>, we can see that the private part of the website is
 published to S3/CloudFront. If you try to access it via CloudFront URL, you&#39;ll
 see that a dialog pops up asking for your username and password.</p>
</div>
</div>
<div id="outline-container-headline-5" class="outline-3">
<h3 id="headline-5">
Tying Private and Public Repositories Together
</h3>
<div id="outline-text-headline-5" class="outline-text-3">
<p>
 Ok so we now have public part of the website working on GitHub pages and the
 private part of the website working on S3/CloudFront. We are now going to tie
 them together using a custom domain name! Domain names are pretty cheap
 (10-20$/yr). So, what I did was I bought this domain name and configured the DNS
 such that <code class="verbatim">harshad.me</code> points to the GitHub URL and <code class="verbatim">personal.harshad.me</code> points
 to cloudfront URL. Here&#39;s how the DNS entries look:</p>
<table>
<tbody>
<tr>
<td>Name</td>
<td>Type</td>
<td>Resolves to</td>
<td>Comment</td>
</tr>
</tbody>
<tbody>
<tr>
<td>harshad.me</td>
<td>A</td>
<td>185.199.108.153</td>
<td>GitHub IPs</td>
</tr>
<tr>
<td></td>
<td></td>
<td>185.199.109.153</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>185.199.110.153</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>185.199.111.153</td>
<td></td>
</tr>
<tr>
<td>aws_verifier_key.personal</td>
<td>CNAME</td>
<td>aws_verifier_val.aws.</td>
<td></td>
</tr>
<tr>
<td>personal</td>
<td>CNAME</td>
<td>CloudFront URL</td>
<td></td>
</tr>
</tbody>
</table>
<p>
 …and there you go! At the end of this, I had my public site live at -
 <a href="http://harshad.me">http://harshad.me</a> and the private part of the site is live at
 <a href="https://personal.harshad.me">https://personal.harshad.me</a>!</p>
<p>


<style> .backlinks {  background-color: lightcyan; } </style>

</p>
</div>
</div>
<div id="outline-container-headline-6" class="outline-2">
<h2 id="headline-6">
Links to this note
</h2>
</div>

    </div>

    
    
        

<div class="tags-wrapper">
    <ul class="post-tags">
        <li>
                <a href="/tags/git/">
                    git
                </a>
            </li>
        <li>
                <a href="/tags/jekyll/">
                    jekyll
                </a>
            </li>
        <li>
                <a href="/tags/tech/">
                    tech
                </a>
            </li>
        <li>
                <a href="/tags/website/">
                    website
                </a>
            </li>
        
    </ul>
</div>

    
</article>

            </main>
        </div>

        <label for="sidebar-checkbox" class="sidebar-toggle"></label>

        <a href="#top-of-site" class="top-of-site-link" data-visible="false">
            <span class="screen-reader-text" aria-label="Back to top of the page">
                Back to top
            </span>
            <svg width="32" height="32" viewBox="0 0 100 100">
                <path fill="white" d="m50 0c-13.262 0-25.98 5.2695-35.355 14.645s-14.645 22.094-14.645 35.355 5.2695 25.98 14.645 35.355 22.094 14.645 35.355 14.645 25.98-5.2695 35.355-14.645 14.645-22.094 14.645-35.355-5.2695-25.98-14.645-35.355-22.094-14.645-35.355-14.645zm20.832 62.5-20.832-22.457-20.625 22.457c-1.207 0.74219-2.7656 0.57812-3.7891-0.39844-1.0273-0.98047-1.2695-2.5273-0.58594-3.7695l22.918-25c0.60156-0.61328 1.4297-0.96094 2.2891-0.96094 0.86328 0 1.6914 0.34766 2.293 0.96094l22.918 25c0.88672 1.2891 0.6875 3.0352-0.47266 4.0898-1.1562 1.0508-2.9141 1.0859-4.1133 0.078125z"></path>
            </svg>
        </a>
    </body>
</html>
