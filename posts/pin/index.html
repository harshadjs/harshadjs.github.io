<!DOCTYPE html>
<html lang="en-us" prefix="og: http://ogp.me/ns#" id="top-of-site">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no">

    <link rel="canonical" href="http://harshad.me/posts/pin/">

    <title>Pin - Harshad</title>
    <meta name="description" content="Anyone who works in a field related to computer software, ends up running a bunch of CLI (command line interface) commands pretty often. The longer you stay in …">
    <meta name="keywords" content="jekyll, tech">

    <meta name="author" content="">
    <meta name="generator" content="Hugo 0.104.3" />

    
    <link crossorigin="anonymous" href="/css/stylesheet.min.ddff76a17889e714853ced93d59096be3dca89927ec0e446c2d9c6b70da094a6.css" integrity="sha256-3f92oXiJ5xSFPO2T1ZCWvj3KiZJ+wORGwtnGtw2glKY=" rel="preload stylesheet" as="style">

    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    <link rel="manifest" type="application/manifest+json" href="/manifest.webmanifest" title="Manifest">
    <link rel="sitemap" type="application/xml" href="/sitemap.xml" title="Sitemap">
    <link rel="author" type="text/plain" href="/humans.txt" title="Humans">


    <meta name="theme-color" content="#ffffff">    
    <meta property="og:title" content="Pin - Harshad">
    <meta property="og:description" content="Anyone who works in a field related to computer software, ends up running a bunch of CLI (command line interface) commands pretty often. The longer you stay in …">
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://harshad.me/posts/pin/">
    <meta property="og:image" content="http://harshad.me/img/open-graph-logo.png">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta property="article:published_time" content="2020-12-21T00:00:00">
    <meta property="article:modified_time" content="2020-12-21T00:00:00">
    <meta property="article:tag" content="jekyll">
    <meta property="article:tag" content="tech">
    
    <meta name="twitter:title" content="Pin - Harshad">
    <meta name="twitter:description" content="Anyone who works in a field related to computer software, ends up running a bunch of CLI (command line interface) commands pretty often. The longer you stay in …">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://harshad.me/img/open-graph-logo.png">
    

<script type="application/ld+json" id="schema-data">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http://harshad.me/posts/pin/"
        },
        "url": "http://harshad.me/posts/pin/",
        "headline": "Pin - Harshad",
        "description": "Anyone who works in a field related to computer software, ends up running a bunch of CLI (command line interface) commands pretty often. The longer you stay in …",
        "keywords": ["jekyll","tech"],
        "datePublished": "2020-12-21T00:00:00Z",
        "dateModified": "2020-12-21T00:00:00Z",
        "publisher": {
            "@type": "Organization",
            "name": "Harshad",
            "logo": {
                "@type": "ImageObject",
                "url": "http://harshad.me/img/open-graph-logo_hu649006a96c7f6a02c0a48e2d90a9a7b0_5229_96x96_resize_box_3.png",
                "width": "96",
                "height": "96"
            }
        }
    }
</script>



    <script src="/js/common.js"></script>
</head>

    <body class="theme-base-">
        <div id="top-of-site-anchor"></div>
        
            
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<aside class="sidebar" id="sidebar">
    <div class="sidebar-item">
        <p></p>
    </div>

    <nav class="sidebar-nav">
            <a class="sidebar-nav-item"
                href="/posts/"
                id="menu-main-posts">Posts</a>
            <a class="sidebar-nav-item"
                href="/music/"
                id="menu-main-music">Music</a>
            <a class="sidebar-nav-item"
                href="/contact/"
                id="menu-main-contact">Contact</a>
            <a class="sidebar-nav-item"
                href="/search/"
                id="menu-main-search">Search</a>
            <a class="sidebar-nav-item"
                href="/about/"
                id="menu-main-about">About</a>
        <span class="hypothesis-container">
    <a class="sidebar-nav-item" id="hypothesis-link" href="#">Annotate me</a>
</span>

    </nav>

    

</aside>

        
        <div class="wrap">
            <header class="masthead">
                <div class="container">
                    <h3 class="masthead-title">
                        <a href="/" title="Home">Harshad</a>
                        <br><small></small>
                    </h3>
                </div>
            </header>

            <main class="container content" id="main">
                <article class="post" role="document">
    <header>
        <h1 class="text-title">
            Pin
        </h1>
        <p class="byline">
            
                


Published on
<time datetime="2020-12-21T00:00:00Z">
    December 21, 2020
</time>




            
        </p>
    </header>

    <div class="post-body">
        
<p>
Anyone who works in a field related to computer software, ends up
running a bunch of CLI (command line interface) commands pretty
often. The longer you stay in the field, the larger is your command
set. With new systems being invented everyday, the complexity of
commands being run is also increasing. Day by day, I am finding myself
running more and more complex commands. That&#39;s when I decided I need
something to manage these commands for me. Shell history is great, but
it is not portable and reliable. So, I have built <code class="verbatim">pin</code>, a portable
commands organizer. Pin is available for use at
<a href="https://github.com/harshadjs/pin.">https://github.com/harshadjs/pin.</a> In this post, I&#39;ll go over some of
the key design choices I made while building this tool.</p>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Portability and the Ease of First Use
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>
I often run complex commands on resource constrained or ill configured
environments which don&#39;t retain any state (ephemeral VMs) or
minimalstic chrooted environments - such as a custom kernel running
with minimal debian image with no network configuration under qemu
virtualization. This often means installing a collection of libraries
and dependencies is not feasible / convenient. Therefore, the primary
goals I had in my mind while designing <code class="verbatim">pin</code> were portability and the
ease of first use.</p>
<p>
So, given the above constraints, how does pin provide ease of first use
and portability?</p>
<p>
Pin is just one shell script that relies on very basic shell programs
(such as <code class="verbatim">base64</code> or <code class="verbatim">sha1sum</code>) for doing most of its work. Therefore,
<code class="verbatim">pin</code> can be run in almost any environment where you have shell access;
and given that you are trying to remember your shell commands, you
… well - do have shell access.</p>
<p>
This makes pin installation a very simple process. Just use <code class="verbatim">wget</code> or
<code class="verbatim">curl</code> to download <code class="verbatim">pin</code> script and you are all set to use it! For
environments where internet connectivity is not available (often
inside qemu while testing custom kernel), you can still paste the
compressed and base64 encoded version of the <code class="verbatim">pin</code> script, which gets
decompressed and decoded by simple shell commands allowing you to use
pin.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Self Identifying Objects
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>
Another design choice that I made was to store commands as files in
the following format which are named as the SHA1 hash of the command
(<code class="verbatim">CMD</code>) itself:</p>
<div class="src src-text">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>CMD=&#34;&lt;base64 encoding of &#34;find . -type f -iname *.[ch] | etags -&#34;&gt;&#34;
</span></span><span style="display:flex;"><span>DESC=&#34;Generate emacs tags&#34;
</span></span><span style="display:flex;"><span>TYPE=cmd</span></span></code></pre></div>
</div>
<p>
This implies that there&#39;s inherent dedpulication of all the commands
stored in <code class="verbatim">pin</code>. Also, self-identification of the object prevents
accidental overwrites of command files.</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Output Caching
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>
Lastly, even though shell is very portable and requires the least
number of dependencies in order to be used, it is definitely slower
compared to say - a python script or a C/C++ compiled program. Since
in the write path, <code class="verbatim">pin</code> mostly performs writes or updates to fixed
set of files, the slowness of shell doesn&#39;t affect the write path
much.</p>
<p>
However, there&#39;s a slight impact on the read path. For example, the
<code class="verbatim">pin grep</code> command which searches for occurence of a term in the
database of commands (which are <code class="verbatim">base64</code> encoded) can be slow if the
number of commands is very high. In order to deal with this problem,
<code class="verbatim">pin</code> implements output caching which allows it to significantly
reduce read path latencies. <code class="verbatim">pin</code> stores output of grep queries in
<code class="verbatim">/tmp</code> folder. There&#39;s some more work needed to maintain and perhaps
configure the size of the cache, but in my experience, the number of
such commands that I run in a reboot cycle has not resulted in any
significant bloating of the cache.</p>
<p>


<style> .backlinks {  background-color: lightcyan; } </style>

</p>
</div>
</div>
<div id="outline-container-headline-4" class="outline-2">
<h2 id="headline-4">
Links to this note
</h2>
</div>

    </div>

    
    
        

<div class="tags-wrapper">
    <ul class="post-tags">
        <li>
                <a href="/tags/jekyll/">
                    jekyll
                </a>
            </li>
        <li>
                <a href="/tags/tech/">
                    tech
                </a>
            </li>
        
    </ul>
</div>

    
</article>

            </main>
        </div>

        <label for="sidebar-checkbox" class="sidebar-toggle"></label>

        <a href="#top-of-site" class="top-of-site-link" data-visible="false">
            <span class="screen-reader-text" aria-label="Back to top of the page">
                Back to top
            </span>
            <svg width="32" height="32" viewBox="0 0 100 100">
                <path fill="white" d="m50 0c-13.262 0-25.98 5.2695-35.355 14.645s-14.645 22.094-14.645 35.355 5.2695 25.98 14.645 35.355 22.094 14.645 35.355 14.645 25.98-5.2695 35.355-14.645 14.645-22.094 14.645-35.355-5.2695-25.98-14.645-35.355-22.094-14.645-35.355-14.645zm20.832 62.5-20.832-22.457-20.625 22.457c-1.207 0.74219-2.7656 0.57812-3.7891-0.39844-1.0273-0.98047-1.2695-2.5273-0.58594-3.7695l22.918-25c0.60156-0.61328 1.4297-0.96094 2.2891-0.96094 0.86328 0 1.6914 0.34766 2.293 0.96094l22.918 25c0.88672 1.2891 0.6875 3.0352-0.47266 4.0898-1.1562 1.0508-2.9141 1.0859-4.1133 0.078125z"></path>
            </svg>
        </a>
    </body>
</html>
